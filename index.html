<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Improvisation</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
    crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
    crossorigin="anonymous"></script>

  <script lang="text/javascript">
Array.prototype.indexOf || (Array.prototype.indexOf = function (d, e) {
  var a;
  if (null == this) throw new TypeError('"this" is null or not defined');
  var c = Object(this),
    b = c.length >>> 0;
  if (0 === b) return -1;
  a = +e || 0;
  Infinity === Math.abs(a) && (a = 0);
  if (a >= b) return -1;
  for (a = Math.max(0 <= a ? a : b - Math.abs(a), 0); a < b;) {
    if (a in c && c[a] === d) return a;
    a++
  }
  return -1
});

(function () {
  var allKeys,
    remainingKeys,
    playedKeys = [],
    signatures = ["9/8", "3/4", "4/4", "6/8"],
    currentKey;

  function nextKey(preferredKey) {
    if (remainingKeys.length === 0) {
      currentKey = null

      $("#currentKey").html("All keys completed! Refresh.")
      return
    }

    if (preferredKey == null) {
      shuffle(remainingKeys)
      currentKey = remainingKeys[0]
    } else {
      currentKey = preferredKey
    }

    $("#currentKey").html("Current Key: " + currentKey)

    shuffle(signatures)
    $("#signature").html("Signature: " + signatures[0])
  }

  function done() {
    var index = remainingKeys.indexOf(currentKey);
    if (index > -1) {
      remainingKeys.splice(index, 1)
      playedKeys.push(currentKey)
      $(".btn-key").filter(function () {
        return $(this).text() === currentKey
      }).removeClass("btn-danger").addClass("btn-success")

      nextKey()
    }
  }

  function shuffle(a) {
    var j, x, i;
    for (i = a.length - 1; i > 0; i--) {
      j = Math.floor(Math.random() * (i + 1));
      x = a[i];
      a[i] = a[j];
      a[j] = x;
    }
    return a;
  }

  $(document).on("click", "#doneButton", done)
  $(document).on("click", "#nextKey", function () { nextKey() })
  $(document).on("click", ".btn-key", function () {
    var key = $(this).text()
    nextKey(key)
  })

  $(function () {
    allKeys = $(".btn-key").map((i, el) => $(el).text()).toArray()
    remainingKeys = allKeys.slice(0)

    shuffle(remainingKeys)
    nextKey()
  })
}())
  </script>
</head>

<body>
  <div class="container">
    <div class="row justify-content-md-center">
      <div class="col-md-6 col-md-offset-2 text-center">
        <h3 id="currentKey">Current Key:</h3>
        <h3 id="signature">Signature:</h3>
        <a id="doneButton" class="btn btn-success" href="#">Done!</a>
      </div>

      <div class="col-md-4">
        <h3>Keys</h3>
        <p>
          Select the key on which you would like to be tested, or just press "next" for a random key. The keys you've completed will
          turn green.
        </p>

        <div class="col">
          <div class="row">
            <div class="col">
              <a id="nextKey" class="btn btn-info w-100">Random Key!</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">C</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">c</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">C&#9839;/D&#9837;</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">c&#9839;/d&#9837;</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">D</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">d</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">D&#9839;/E&#9837;</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">d&#9839;/e&#9837;</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">E</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">e</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">F</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">f</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">F&#9839;/G&#9837;</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">f&#9839;/g&#9837;</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">G</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">g</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">G&#9839;/A&#9837;</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">g&#9839;/a&#9837;</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">A</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">a</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">A&#9839;/B&#9837;</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">a&#9839;/b&#9837;</a>
            </div>
          </div>
          <div class="row justify-content-md-center mt-1">
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">B</a>
            </div>
            <div class="col">
              <a class="btn btn-danger btn-key w-100" href="#">b</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>
